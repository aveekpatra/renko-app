# üîê Auth Troubleshooting - Quick Fix Guide

**For AI Development**: Common auth issues and solutions.

## üöÄ **WORKING AUTH SETUP**

### **Files in Place** ‚úÖ

```
convex/auth.ts       # Main auth config with Password + Google
middleware.ts        # Route protection
app/signin/page.tsx  # Split-screen login with OAuth
app/signup/page.tsx  # Split-screen signup with OAuth
```

### **Environment Variables** ‚úÖ

```bash
# Convex Auth (Working)
JWKS=<auto-generated>
JWT_PRIVATE_KEY=<auto-generated>
SITE_URL=http://localhost:3000

# Google OAuth (Optional but Working)
AUTH_GOOGLE_ID=<google-client-id>
AUTH_GOOGLE_SECRET=<google-client-secret>
```

## üîß **COMMON ISSUES**

### **1. Authentication Errors**

```
Error: "Not authenticated"
Fix: Check if user is logged in with getAuthUserId(ctx)
```

### **2. Google OAuth Not Working**

```bash
# Missing environment variables
AUTH_GOOGLE_ID=your_google_client_id
AUTH_GOOGLE_SECRET=your_google_client_secret

# Wrong redirect URI in Google Console
http://localhost:3000/api/auth/callback/google
```

### **3. Middleware Issues**

```typescript
// middleware.ts should have:
import { convexAuthNextjsMiddleware } from "@convex-dev/auth/nextjs";
export default convexAuthNextjsMiddleware();
```

### **4. Route Protection**

```typescript
// In any page/API
const userId = await getAuthUserId(ctx);
if (!userId) {
  throw new Error("Not authenticated");
}
```

### **5. Development vs Production**

```bash
# Development
SITE_URL=http://localhost:3000

# Production
SITE_URL=https://yourdomain.com
```

## üõ†Ô∏è **DEBUGGING STEPS**

1. **Check auth state**: Use browser dev tools to inspect auth tokens
2. **Verify environment**: Ensure all variables are set in Convex dashboard
3. **Google Console**: Verify redirect URIs match exactly
4. **Clear cache**: Clear browser cache and Convex dev server
5. **Check logs**: Use `npx convex logs` for server errors

## üìã **WORKING AUTH FLOW**

1. User visits `/signin` or `/signup`
2. Chooses Password or Google OAuth
3. Convex Auth processes authentication
4. Middleware protects routes automatically
5. Functions use `getAuthUserId(ctx)` for user context

Auth is fully working - these are just common troubleshooting scenarios.
